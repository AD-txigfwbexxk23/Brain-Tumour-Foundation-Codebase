{% extends 'base.html' %}
{% block content %}

      {% if errors and errors|length %}
      <div class="mb-4 rounded-md bg-red-50 p-4 border border-red-200">
        <div class="text-red-800 font-medium mb-2">Input validation errors</div>
        <ul class="list-disc pl-6 text-red-700">
          {% for e in errors %}<li>{{ e }}</li>{% endfor %}
        </ul>
      </div>
      {% endif %}

      <div class="w-full px-6 py-8 grid grid-cols-1 lg:grid-cols-3 gap-6 flex-1">
        <section class="bg-white rounded-lg shadow p-6 card-raise lg:col-span-2">
          <h2 class="text-xl font-semibold text-slate-800 mb-4">Patient Data</h2>
          <form method="post" action="/predict" class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-slate-700">Age (years)</label>
              <input name="Age" type="number" step="1" min="0" max="120" value="{{ values.Age or 50 }}" class="mt-1 w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-700">Tumor Size (cm)</label>
              <input name="Tumor_Size" type="number" step="0.1" min="0.1" max="20" value="{{ values.Tumor_Size or 5.0 }}" class="mt-1 w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500" required>
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-700">Tumor Growth Rate</label>
              <select name="Tumor_Growth_Rate" class="mt-1 w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500">
                {% for v in ['Slow','Moderate','Rapid'] %}
                  <option value="{{ v }}" {% if values.Tumor_Growth_Rate==v %}selected{% endif %}>{{ v }}</option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-700">Symptom Severity</label>
              <select name="Symptom_Severity" class="mt-1 w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500">
                {% for v in ['Mild','Moderate','Severe'] %}
                  <option value="{{ v }}" {% if values.Symptom_Severity==v %}selected{% endif %}>{{ v }}</option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-700">Tumor Location</label>
              <select name="Tumor_Location" class="mt-1 w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500">
                {% for v in ['Frontal','Temporal','Parietal','Occipital','Cerebellum'] %}
                  <option value="{{ v }}" {% if values.Tumor_Location==v %}selected{% endif %}>{{ v }}</option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-700">MRI Findings</label>
              <select name="MRI_Findings" class="mt-1 w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500">
                {% for v in ['Normal','Abnormal','Severe'] %}
                  <option value="{{ v }}" {% if values.MRI_Findings==v %}selected{% endif %}>{{ v }}</option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-700">Radiation Exposure</label>
              <select name="Radiation_Exposure" class="mt-1 w-full rounded-md border-slate-300 focus:border-indigo-500 focus:ring-indigo-500">
                {% for v in ['Low','Medium','High'] %}
                  <option value="{{ v }}" {% if values.Radiation_Exposure==v %}selected{% endif %}>{{ v }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-span-2 mt-2">
              <button type="submit" class="px-4 py-2 rounded-md bg-indigo-600 text-white font-semibold hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-200 transition-transform transform hover:-translate-y-0.5">Generate Prediction</button>
            </div>
          </form>
        </section>

        <section class="bg-white rounded-lg shadow p-6 card-raise lg:col-span-1 lg:sticky lg:top-6 self-start">
          <h2 class="text-xl font-semibold text-slate-800 mb-4">Results</h2>
          {% if result %}
          <div class="grid grid-cols-2 gap-4">
            <div class="p-4 rounded-lg bg-indigo-50 border border-indigo-200 fade-in">
              <div class="text-sm text-slate-600">Predicted Survival Rate</div>
              <div class="text-3xl font-bold text-indigo-900">{{ result.survival_rate }}%</div>
            </div>
            <div class="p-4 rounded-lg bg-emerald-50 border border-emerald-200 fade-in-delay">
              <div class="text-sm text-slate-600">Recommended Treatment</div>
              <div class="text-2xl font-bold text-emerald-900">{{ result.treatment }}</div>
              <div class="text-slate-600 text-sm">Confidence: {{ result.treatment_confidence }}%</div>
            </div>
          </div>
          <div class="mt-6">
            <h3 class="font-semibold text-slate-800 mb-2">Treatment Probabilities</h3>
            <div class="space-y-3">
              {% for label, prob in result.all_treatment_probs.items() %}
              <div>
                <div class="flex justify-between text-sm mb-1">
                  <span class="font-medium text-slate-700">{{ label }}</span>
                  <span class="text-slate-900">{{ prob }}%</span>
                </div>
                <div class="h-2 w-full bg-slate-200 rounded overflow-hidden">
                  <div class="h-2 bg-gradient-to-r from-indigo-500 to-sky-500 progress-bar" style="width: {{ prob }}%"></div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% else %}
          <p class="text-slate-600">Submit patient data to view predictions.</p>
          {% endif %}
        </section>
        
        <section class="bg-white rounded-lg shadow p-6 card-raise lg:col-span-3">
          <h2 class="text-xl font-semibold text-slate-800 mb-4">Overview</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="metric-tile">
              <div class="text-slate-600 text-sm">Key Factor</div>
              <div class="text-slate-900 text-lg font-semibold">Tumor Size</div>
            </div>
            <div class="metric-tile">
              <div class="text-slate-600 text-sm">Model Status</div>
              <div class="text-slate-900 text-lg font-semibold">Loaded</div>
            </div>
            <div class="metric-tile">
              <div class="text-slate-600 text-sm">Engine</div>
              <div class="text-slate-900 text-lg font-semibold">PyTorch Â· FastAPI</div>
            </div>
          </div>
          <details class="mt-6 group">
            <summary class="cursor-pointer select-none text-slate-700 font-medium hover:text-slate-900 transition-colors">What this tool provides</summary>
            <div class="mt-2 text-slate-600 leading-relaxed">
              Survival rate prediction, treatment recommendation with confidence, and breakdown of treatment probabilities.
            </div>
          </details>
        </section>
      </div>

{% endblock %}


